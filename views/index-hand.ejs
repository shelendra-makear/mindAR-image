<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Right Wrist Ã— Left Elbow Collision</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body { margin: 0; overflow: hidden; background: black; }
  video, canvas {
    position: absolute;
    top: 0;
    left: 0;
  }
  canvas { z-index: 10; }
</style>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
</head>

<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script >const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// -------- LOAD IMAGE --------
const productImg = new Image();
productImg.src = "assets/images/foam.png";

// -------- POSE --------
const pose = new Pose({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});

pose.setOptions({
  modelComplexity: 1,
  smoothLandmarks: true,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

let poseResults = null;
pose.onResults(res => poseResults = res);

// -------- CAMERA --------
const camera = new Camera(video, {
  onFrame: async () => {
    await pose.send({ image: video });
    draw();
  },
  width: 640,
  height: 480
});
camera.start();

// -------- DRAW --------
function draw() {
  if (!poseResults?.poseLandmarks) return;

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const leftElbow = poseResults.poseLandmarks[13];
  const rightWrist = poseResults.poseLandmarks[16];

  if (!leftElbow || !rightWrist) return;

  const x1 = leftElbow.x * canvas.width;
  const y1 = leftElbow.y * canvas.height;
  const x2 = rightWrist.x * canvas.width;
  const y2 = rightWrist.y * canvas.height;

  // -------- COLLISION CHECK --------
  const distance = Math.hypot(x2 - x1, y2 - y1);
  const COLLISION_THRESHOLD = 60; // pixels (adjust)

  if (distance < COLLISION_THRESHOLD) {
    drawProduct(x1, y1);
  }
}

// -------- DRAW IMAGE --------
function drawProduct(x, y) {
  const size = 120;

  ctx.save();
  ctx.translate(x, y);
  ctx.drawImage(
    productImg,
    -size / 2,
    -size / 2,
    size,
    size
  );
  ctx.restore();
}
</script>
</body>
</html>
